var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id
})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;app.root="/course_mapping_tool",Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:this.serverUrl+"/course_mapping_tool/manager/index.php/courses",model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;app.root="/course_mapping_tool",Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:this.serverUrl+"/course_mapping_tool/manager/index.php/courses",model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:this.serverUrl+"/course_mapping_tool/manager/index.php/courses",model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:this.serverUrl+"/course_mapping_tool/manager/index.php/courses",model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:this.serverUrl+"/course_mapping_tool/manager/index.php/courses",model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:this.serverUrl+"/course_mapping_tool/manager/index.php/courses",model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:this.serverUrl+"/course_mapping_tool/manager/index.php/courses",model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:this.serverUrl+"/course_mapping_tool/manager/index.php/courses",model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:this.serverUrl+"/course_mapping_tool/manager/index.php/courses",model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:this.serverUrl+"/course_mapping_tool/manager/index.php/courses",model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,
initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:this.serverUrl+"/course_mapping_tool/manager/index.php/courses",model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:this.serverUrl+"/course_mapping_tool/manager/index.php/courses",model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:this.serverUrl+"/course_mapping_tool/manager/index.php/courses",model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:this.serverUrl+"/course_mapping_tool/manager/index.php/courses",model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var router=new app.Router;Backbone.history.start();var app=app||{};app.CourseMapperCollection=Backbone.Collection.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessments=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/assessments"},model:app.assessment,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.assessments(filtered,{course_id:this.course_id})}});var app=app||{};app.courses=app.CourseMapperCollection.extend({url:this.serverUrl+"/course_mapping_tool/manager/index.php/courses",model:app.course});var app=app||{};app.criteria=app.CourseMapperCollection.extend({url:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},model:app.criterion,initialize:function(a,b){"undefined"!=typeof b?(this.assessment_id=b.assessment_id,this.course_id=b.course_id):(this.assessment_id=parseInt(a.model.get("assessment_id")),this.course_id=parseInt(a.model.get("course_id")))}});var app=app||{};app.learningActivities=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_activities"},model:app.learningActivity,initialize:function(a,b){_.bindAll(this,"byLearningOutcomeId"),this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))},byLearningOutcomeId:function(a){return filtered=this.filter(function(b){var c=JSON.parse(b.get("learning_outcomes"));return-1!==c.indexOf(a)}),new app.learningActivities(filtered,{course_id:this.course_id})}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.learningOutcomes=app.CourseMapperCollection.extend({url:function(){var a=this.course_id;return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a+"/learning_outcomes"},model:app.learningOutcome,initialize:function(a,b){this.course_id="undefined"!=typeof b?b.course_id:parseInt(a.model.get("course_id"))}});var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{"":"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.courses}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("show.bs.modal").on("show.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};
app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{"":"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.courses}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("show.bs.modal").on("show.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];

(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{"":"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.courses}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("show.bs.modal").on("show.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{"":"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.courses}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),
$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("show.bs.modal").on("show.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{"":"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.courses}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("show.bs.modal").on("show.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},
template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{"":"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.courses}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("show.bs.modal").on("show.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),
c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{"":"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.courses}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("show.bs.modal").on("show.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{"":"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.courses}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a
}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("show.bs.modal").on("show.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{"":"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.courses}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("show.bs.modal").on("show.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),
this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{"":"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.courses}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("show.bs.modal").on("show.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),
d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{"":"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.courses}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("show.bs.modal").on("show.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){
this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{"":"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.courses}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("show.bs.modal").on("show.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{"":"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.courses}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("show.bs.modal").on("show.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},
events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{home:"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},home:function(){window.location="/"},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.courses}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("shown.bs.modal").on("shown.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100
},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{home:"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},home:function(){window.location="/course_mapping_tool"},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.courses}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("shown.bs.modal").on("shown.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";

isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{home:"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},home:function(){var a=new app.courses({model:app.course});a.fetch({data:{page:1,limit:100},success:function(a){var b=new app.courseListView({collection:a}),c=_.template($("#homeForm").html()),d=_.template($("#homeControls").html());$("#main").html(""),$("#main").append(c),$("#main table").append(b.render().el),$("#controls").html(d)}})},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.course}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("shown.bs.modal").on("shown.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{home:"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},home:function(){var a=new app.courses({model:app.course});a.fetch({data:{page:1,limit:100},success:function(a){var b=new app.courseListView({collection:a}),c=_.template($("#homeForm").html()),d=_.template($("#homeControls").html());$("#main").html(""),$("#main").append(c),$("#main table").append(b.render().el),$("#controls").html(d)}})},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.course}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){
var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("shown.bs.modal").on("shown.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{home:"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},home:function(){var a=new app.courses({model:app.course});a.fetch({data:{page:1,limit:100},success:function(a){var b=new app.courseListView({collection:a}),c=_.template($("#homeForm").html()),d=_.template($("#homeControls").html());$("#main").html(""),$("#main").append(c),$("#main table").append(b.render().el),$("#controls").html(d)}})},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.course}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("shown.bs.modal").on("shown.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),
render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{home:"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},home:function(){var a=new app.courses({model:app.course});a.fetch({data:{page:1,limit:100},success:function(a){var b=new app.courseListView({collection:a}),c=_.template($("#homeForm").html()),d=_.template($("#homeControls").html());$("#main").html(""),$("#main").append(c),$("#main table").append(b.render().el),$("#controls").html(d)}})},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.course}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("shown.bs.modal").on("shown.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";

this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{home:"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},home:function(){var a=new app.courses({model:app.course});a.fetch({data:{page:1,limit:100},success:function(a){var b=new app.courseListView({collection:a}),c=_.template($("#homeForm").html()),d=_.template($("#homeControls").html());$("#main").html(""),$("#main").append(c),$("#main table").append(b.render().el),$("#controls").html(d)}})},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.course}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("shown.bs.modal").on("shown.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{home:"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},home:function(){var a=new app.courses({model:app.course});a.fetch({data:{page:1,limit:100},success:function(a){var b=new app.courseListView({collection:a}),c=_.template($("#homeForm").html()),d=_.template($("#homeControls").html());$("#main").html(""),
$("#main").append(c),$("#main table").append(b.render().el),$("#controls").html(d)}})},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.course}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("shown.bs.modal").on("shown.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{home:"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},home:function(){var a=new app.courses({model:app.course});a.fetch({data:{page:1,limit:100},success:function(a){var b=new app.courseListView({collection:a}),c=_.template($("#homeForm").html()),d=_.template($("#homeControls").html());$("#main").html(""),$("#main").append(c),$("#main table").append(b.render().el),$("#controls").html(d)}})},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.course}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("shown.bs.modal").on("shown.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;

case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{home:"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},home:function(){var a=new app.courses({model:app.course});a.fetch({data:{page:1,limit:100},success:function(a){var b=new app.courseListView({collection:a}),c=_.template($("#homeForm").html()),d=_.template($("#homeControls").html());$("#main").html(""),$("#main").append(c),$("#main table").append(b.render().el),$("#controls").html(d)}})},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.course}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("shown.bs.modal").on("shown.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({
tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{home:"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},home:function(){var a=new app.courses({model:app.course});a.fetch({data:{page:1,limit:100},success:function(a){var b=new app.courseListView({collection:a}),c=_.template($("#homeForm").html()),d=_.template($("#homeControls").html());$("#main").html(""),$("#main").append(c),$("#main table").append(b.render().el),$("#controls").html(d)}})},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.course}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("shown.bs.modal").on("shown.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria";

},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{home:"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},home:function(){var a=new app.courses({model:app.course});a.fetch({data:{page:1,limit:100},success:function(a){var b=new app.courseListView({collection:a}),c=_.template($("#homeForm").html()),d=_.template($("#homeControls").html());$("#main").html(""),$("#main").append(c),$("#main table").append(b.render().el),$("#controls").html(d)}})},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.course}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("shown.bs.modal").on("shown.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{home:"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},home:function(){var a=new app.courses({model:app.course});a.fetch({data:{page:1,limit:100},success:function(a){var b=new app.courseListView({collection:a}),c=_.template($("#homeForm").html()),d=_.template($("#homeControls").html());$("#main").html(""),$("#main").append(c),$("#main table").append(b.render().el),$("#controls").html(d)}})},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.course}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),
$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("shown.bs.modal").on("shown.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{home:"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},home:function(){var a=new app.courses({model:app.course});a.fetch({data:{page:1,limit:100},success:function(a){var b=new app.courseListView({collection:a}),c=_.template($("#homeForm").html()),d=_.template($("#homeControls").html());$("#main").html(""),$("#main").append(c),$("#main table").append(b.render().el),$("#controls").html(d)}})},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.course}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("shown.bs.modal").on("shown.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){
var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{home:"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},home:function(){var a=new app.courses({model:app.course});a.fetch({data:{page:1,limit:100},success:function(a){var b=new app.courseListView({collection:a}),c=_.template($("#homeForm").html()),d=_.template($("#homeControls").html());$("#main").html(""),$("#main").append(c),$("#main table").append(b.render().el),$("#controls").html(d)}})},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.course}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("shown.bs.modal").on("shown.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),
c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{home:"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},home:function(){var a=new app.courses({model:app.course});a.fetch({data:{page:1,limit:100},success:function(a){var b=new app.courseListView({collection:a}),c=_.template($("#homeForm").html()),d=_.template($("#homeControls").html());$("#main").html(""),$("#main").append(c),$("#main table").append(b.render().el),$("#controls").html(d)}})},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.course}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("shown.bs.modal").on("shown.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){switch(this.model,a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){switch(this.model,a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){switch(this.model,a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){switch(this.model,a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");var app=app||{};app.CourseMapperModel=Backbone.Model.extend({serverUrl:"https://bold.newcastle.edu.au"});var app=app||{};app.assessment=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/assessments"},defaults:{name:"e.g. Verbal test",details:"e.g. Students conduct a conversation with an assessor for 15 minutes",type:"formative",week:1,weight:.1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")){var c="Week must be a number between 1 and 127.";if("ongoing"!=a.week)if(isNaN(a.week)){var d=a.week.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];(isNaN(e)||isNaN(f))&&b.push({field:"week",message:c}),e>f&&b.push({field:"week",message:"End week must be after start week."})}else(a.week<1||a.week>127)&&b.push({field:"week",message:c})}if(_.has(a,"weight")){var c="Weight must be a number between 1 and 100.";isNaN(a.weight)?b.push({field:"weight",message:c}):(a.weight<0||a.weight>1)&&b.push({field:"weight",message:c})}return 0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.course=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses"},defaults:{name:"e.g. Introduction to Mandarin",code:"e.g. MAN101",duration:13,course_id:0},validate:function(a){var b=[];if(_.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"code")&&a.code.length>12&&b.push({field:"code",message:"Code cannot be longer than 12 characters."}),_.has(a,"duration")&&isNaN(a.duration)){var c="Duration must be a number between 1 and 127.";isNaN(a.duration)?b.push({field:"duration",message:c}):(a.duration<1||a.duration>127)&&b.push({field:"duration",message:c})}return 0!==b.length?b:void 0},initialize:function(){}});var app=app||{};app.criterion=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/assessments/"+this.assessment_id+"/criteria"},defaults:{description:"Student demonstrates understanding of ... ",col1:"Showed no understanding of...",col2:"Demonstrated a basic understanding of...",col3:"Demonstrated a competent understanding of...",col4:"Demonstrated a thorough understanding of ...",col5:"Demonstrated exceptional understanding of...	",assessment_id:0},validate:function(a){var b="This descriptor cannot be longer than %n characters.",c=[];return _.has(a,"description")&&a.description.length>1e3&&(msg=b.replace("%n","1000"),c.push({field:"description",message:msg})),msg=b.replace("%n","500"),_.has(a,"col1")&&a.col1.length>500&&c.push({field:"col1",message:msg}),_.has(a,"col2")&&a.col2.length>500&&c.push({field:"col2",message:msg}),_.has(a,"col3")&&a.col2.length>500&&c.push({field:"col3",message:msg}),_.has(a,"col4")&&a.col2.length>500&&c.push({field:"col4",message:msg}),_.has(a,"col5")&&a.col2.length>500&&c.push({field:"col5",message:msg}),0!==c.length?c:void 0},initialize:function(a){this.assessment_id=a.assessment_id}});var app=app||{};app.learningActivity=app.CourseMapperModel.extend({urlRoot:function(){return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+this.course_id+"/learning_activities"},defaults:{name:"e.g. Conduct a conversation",details:"e.g. Students conduct a conversation with a native speaker of Mandarin",type:"in class",week:1,course_id:0,learning_outcomes:[],extra:[]},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),_.has(a,"week")&&isNaN(a.week)&&b.push({field:"week",message:"Week must be a number between 1 and 255."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.learningOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/courses/"+a+"/learning_outcomes"},defaults:{name:"Learning Outcome ",details:"e.g. Students can demonstrate how to use a verb in Mandarin",course_id:0,extra:[],myIndex:0},validate:function(a){var b=[];return _.has(a,"name")&&a.name.length>255&&b.push({field:"name",message:"Name cannot be longer than 255 characters."}),_.has(a,"details")&&a.details.length>5e3&&b.push({field:"details",message:"Details cannot be longer than 5000 characters."}),0!==b.length?b:void 0},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.mappedOutcome=app.CourseMapperModel.extend({urlRoot:function(){var a=this.get("course_id");return this.serverUrl+"/course_mapping_tool/manager/index.php/summary/"+a},defaults:{name:""},initialize:function(a){this.course_id=a.course_id}});var app=app||{};app.Router=Backbone.Router.extend({routes:{home:"home",add_course:"add_course","edit_course/:course_id":"edit_course","learning_outcomes/:course_id":"learning_outcomes","learning_activities/:course_id":"learning_activities","assessments/:course_id":"assessments","criteria/:course_id/:assessment_id":"criteria","summary/:course_id":"summary",goback:"goback"},home:function(){var a=new app.courses({model:app.course});a.fetch({data:{page:1,limit:100},success:function(a){var b=new app.courseListView({collection:a}),c=_.template($("#homeForm").html()),d=_.template($("#homeControls").html());$("#main").html(""),$("#main").append(c),$("#main table").append(b.render().el),$("#controls").html(d)}})},add_course:function(){var a=new app.course;a.save(a.toJSON(),{success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());

c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()},error:function(){alert("Server problem, please try again.")}})},edit_course:function(a){var b=(new app.courses({model:app.course}),new app.course({id:a}));b.fetch({success:function(a){var b=new app.addCourseView({model:a}),c=_.template($("#addCourseControls").html());c=c(a.toJSON()),$("#main").html(b.render().el),$("#controls").html(c),b.delegateEvents()}})},learning_outcomes:function(a){var b=function(a){var b=new app.learningOutcomesView({collection:a}),c=new app.learningOutcomesTable({collection:a}),d=_.template($("#learningOutcomesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),c.delegateEvents()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningOutcome({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},learning_activities:function(a){var b=function(a){var b=new app.learningActivitiesView({collection:a}),c=new app.learningActivitiesTable({collection:a}),d=_.template($("#learningActivitiesControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.learningActivities({model:app.learningActivity},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.learningActivity({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},assessments:function(a){var b=function(a){var b=new app.assessmentsView({collection:a}),c=new app.assessmentsTable({collection:a}),d=_.template($("#assessmentsControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},c=new app.assessments({model:app.assessment},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(c){if(0===c.length){var d=new app.assessment({course_id:a});c.create(d,{success:function(){b(c)},error:function(){alert("Server error, please try again.")}})}else b(c)}})},criteria:function(a,b){var c=function(a){var b=new app.criteriaView({collection:a}),c=new app.criteriaTable({collection:a}),d=_.template($("#criteriaControls").html());d=d({course_id:a.course_id}),$("#main").html(""),$("#main").append(b.render().el),$("#main table").append(c.render().el),$("#controls").html(d),$("select").chosen()},d=new app.criteria({model:app.criterion},{course_id:a,assessment_id:b});d.fetch({data:{page:1,limit:100},success:function(a){if(0===a.length){var d=new app.criterion({assessment_id:b});a.create(d,{success:function(){c(a)},error:function(){alert("Server error, please try again.")}})}else c(a)}})},summary:function(a){var b=function(a){var b=new app.summaryTable({collection:a.learningOutcomes,learningActivities:a.learningActivities,assessments:a.assessments}),c=_.template($("#summaryControls").html());c=c({course_id:a.learningOutcomes.course_id});var d=new app.summaryView({collection:a.learningOutcomes});$("#main").html(""),$("#main").append(d.render().el),$("#main table").append(b.render().el),$("#controls").html(c),$("select").chosen()},c=new app.learningOutcomes({model:app.learningOutcome},{course_id:a});c.fetch({data:{page:1,limit:100},success:function(d){var e=new app.learningActivities(d,{course_id:a});e.fetch({data:{page:1,limit:100},success:function(e){var f=new app.assessments(d,{course_id:a});f.fetch({data:{page:1,limit:100},success:function(a){b({learningOutcomes:c,learningActivities:e,assessments:a})}})}})}})}});var CourseMapperView=Backbone.View.extend({initialize:function(){Backbone.View.prototype.initialize.apply(this)},deleteCallback:{},setDeleteAction:function(a){this.deleteCallback=a},deleteDialog:function(a,b){if($("#confirm-delete").remove(),0==$("#confirm-delete").length){var c=_.template($("#modalDialog").html());$("#controls").append(c({message:b,header:a}))}var d=this,e=function(){$("#confirm-delete .modal-header").html(a),$("#confirm-delete .modal-body").html(b),$("#confirm-delete .btn-ok").click(function(){d.deleteCallback(),$("#confirm-delete").modal("hide")})};$("#controls #confirm-delete").off("shown.bs.modal").on("shown.bs.modal",e)},genericDialog:function(a,b){if($("#alert-message").remove(),0==$("#alert-message").length){var c=_.template($("#modalDialogOK").html());$("#controls").append(c({message:b,header:a})),$("#alert-message").modal("show")}var d=function(){$("#alert-message .modal-header").html(a),$("#alert-message .modal-body").html(b)};$("#controls #alert-message").off("show.bs.modal").on("show.bs.modal",d)},validationCheck:function(a,b,c){c=c||{},$(b).parent().removeClass("has-error has-success has-warning").find(".help-block").remove();var d={};d[a]="undefined"!=typeof c.divide?$(b).val()/c.divide:$(b).val();var e=this.model.validate(d);if("undefined"!=typeof e&&e.length>0){var f=e[0],g=$(b);g.parent().addClass("has-error"),g.after("<span class='help-block'>"+f.message+"</span>")}else $(b).parent().addClass("has-success");this.model.set(d),this.model.isValid()&&this.model.save()},buildPredefOptions:function(a,b){var c="";return $(a).each(function(){var a="<option ";b==this&&(a+="selected"),a+=">"+this+"</option>\n",c+=a}),c},buildLearningOutcomeOptions:function(){var a="",b=this.model.get("learning_outcomes");return 0==b.length&&(b=[]),this.model.extra.allLearningOutcomes.each(function(c){var d=c.get("id"),e=c.get("name"),f="<option value='"+d+"'";-1!=b.indexOf(c.id)&&(f+="selected"),f+=">"+e+"</option>\n",a+=f}),delete this.model.extra,a}}),app=app||{};app.addCourseView=CourseMapperView.extend({initialize:function(){},events:{change:function(a){this.model;switch(a.target.id){case"name":case"code":case"duration":this.validationCheck(a.target.id,a.target)}}},template:_.template($("#addCourseForm").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.assessmentRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#assessmentRow").html()),weekTemplate1:_.template($("#assessmentWeekDefault").html()),weekTemplate2:_.template($("#assessmentWeekAlt").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"week1":case"week2":var b=this.$el.find("#week1").val(),c=this.$el.find("#week2").val();this.$el.find("#week_type"+this.model.id+"_1").prop("checked",!0),this.model.set("week",b+"_"+c),this.validationCheck(a.target.id,a.target);break;case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target);break;case"type":var d=this.$el.find("#week").val();this.updateWeekInputState($(a.target).find(":selected").val(),d),this.validationCheck(a.target.id,a.target);break;case"weight":this.validationCheck(a.target.id,a.target,{divide:100})}a.target.name=="week_radio"+this.model.id&&(a.target.id=="week_type"+this.model.id+"_2"&&(this.model.set("week","ongoing"),this.validationCheck(a.target.id,a.target,{divide:100})),a.target.id=="week_type"+this.model.id+"_1"&&this.$el.find("#week1").val().length>0&&this.$el.find("#week2").val().length>0&&this.$el.find("#week1").trigger("change"))}},updateWeekInputState:function(a,b){switch(a){case"summative":case"diagnostic":this.$el.find("#week1").parent().css({width:"2em",padding:"1em"}),this.$el.find("#week1").parent().html(this.weekTemplate1({week:b,id:this.model.id}));break;case"formative":this.$el.find("#week").parent().css({width:"12em",padding:"1em"});var c=this.model.get("week");if(c.length>0)if(-1!=c.indexOf("_")){var d=c.split("_"),e="undefined"==typeof d[0]?0:d[0],f="undefined"==typeof d[1]?0:d[1];this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:'checked="1"',radio2:""})),this.$el.find("#week1").val(e),this.$el.find("#week2").val(f)}else this.$el.find("#week").parent().html(this.weekTemplate2({week:b,id:this.model.id,radio1:"",radio2:'checked="1"'}))}},render:function(){var a=["formative","summative","diagnostic"],b=this.model.get("type").toLowerCase(),c=this.buildPredefOptions(a,b),d=this.$el.find("#week").val(),e=this.buildLearningOutcomeOptions(),f=this.model.toJSON();f.learning_outcomes=e,f.type=c;var g=this.template(f);return this.$el.html(g),this.updateWeekInputState(b,d),this}});var app=app||{};app.assessmentsTable=CourseMapperView.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){this.model;switch(a.target.id){case"delete":var b="<strong class='text-warning'>Warning! Delete assessment forever?</strong>",c="This will also delete any rubrics associated with this assessment.";this.setDeleteAction(function(){var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}),this.deleteDialog(b,c)}},change:function(a){switch(a.target.id){case"weight":var b=0;if(this.collection.each(function(a){b+=parseFloat(a.get("weight"))}),b>1){var c=(100*b).toFixed();this.genericDialog("<strong class='text-danger'>Weightings greater than 100%</strong>","Your assessment weightings are "+c+"%. Please lower some weightings.")}}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addAssessment,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addAssessment:function(a){a.extra=this.extra;var b=new app.assessmentRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.assessmentsView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){this.model;switch(a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#assessmentsForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.courseListView=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(app.courses,"change",this.render)},render:function(){return this.$el.html(""),this.collection.each(this.addCourse,this),this},addCourse:function(a){var b=new app.courseRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.courseRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#courseRow").html()),controls:_.template($("#addCourseControls").html()),render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this},events:{mousedown:function(a){"delete"===a.target.id?this.deleteCourse():this.loadCourse()}},loadCourse:function(){window.location.href="#edit_course/"+this.model.get("id")},deleteCourse:function(){var a="<strong class='text-warning'>Warning! Completely delete this course forever?</strong>",b="This will delete this entire course and all its learning outcomes, activities, assessments and rubrics.";this.setDeleteAction(function(){this.model.destroy({success:function(){location.reload()}})}),this.deleteDialog(a,b)}});var app=app||{};app.criteriaTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){this.model;switch(a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addCriterion,this),this},addCriterion:function(a){var b=new app.criterionRow({model:a});this.$el.append(b.render().el)}});var app=app||{};app.criteriaView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){this.model;switch(a.target.id){case"add_row":this.collection.create({assessment_id:this.collection.assessment_id},{wait:!0})}}},template:_.template($("#criteriaForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.criterionRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#criterionRow").html()),events:{change:function(a){this.model;switch(a.target.id){case"description":case"col1":case"col2":case"col3":case"col4":case"col5":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningActivitiesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){_.bindAll(this,"createSuccess"),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){this.model;switch(a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},extra:{allLearningOutcomes:[]},createSuccess:function(a){this.extra={allLearningOutcomes:a},this.collection.each(this.addLearningActivity,this)},render:function(){this.$el.html("");var a=new app.learningOutcomes({model:app.learningOutcome},{course_id:this.collection.course_id});return a.fetch({data:{page:1,limit:100},success:this.createSuccess}),this},addLearningActivity:function(a){a.extra=this.extra;var b=new app.learningActivityRow({model:a});this.$el.append(b.render().el),$("select").chosen()}});var app=app||{};app.learningActivitiesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){this.model;switch(a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningActivitiesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.learningActivityRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningActivityRow").html()),events:{change:function(a){switch(a.target.id){case"name":case"details":case"type":case"week":case"learning_outcomes":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.buildLearningOutcomeOptions(),b=["in class","out of class"],c=this.model.get("type").toLowerCase(),d=this.buildPredefOptions(b,c),e=this.model.toJSON();e.learning_outcomes=a,e.type=d;var f=this.template(e);return this.$el.html(f),$("select").chosen(),this}});var app=app||{};app.learningOutcomeRow=CourseMapperView.extend({tagName:"tr",template:_.template($("#learningOutcomeRow").html()),events:{change:function(a){this.model;switch(a.target.id){case"name":case"details":this.validationCheck(a.target.id,a.target)}}},render:function(){var a=this.template(this.model.toJSON());return this.$el.html(a),this}});var app=app||{};app.learningOutcomesTable=Backbone.View.extend({tagName:"tbody",initialize:function(){this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"add",this.render)},events:{mousedown:function(a){this.model;switch(a.target.id){case"delete":var b=$(a.target).data("id"),c=this.collection.remove(b);c.destroy()}}},render:function(){return this.$el.html(""),this.collection.each(this.addLearningOutcome,this),this},addLearningOutcome:function(a){var b=a.get("name"),c=this.collection.indexOf(a);"Learning Outcome "==b&&(b+=(c+1).toString(),a.set("name",b),a.save());var d=new app.learningOutcomeRow({model:a});this.$el.append(d.render().el),d.delegateEvents()}});var app=app||{};app.learningOutcomesView=Backbone.View.extend({initialize:function(){},events:{mousedown:function(a){this.model;switch(a.target.id){case"add_row":this.collection.create({course_id:this.collection.course_id},{wait:!0})}}},template:_.template($("#learningOutcomesForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}});var app=app||{};app.summaryTable=CourseMapperView.extend({tagName:"tbody",initialize:function(a){this.learningActivities=a.learningActivities,this.assessments=a.assessments},render:function(){this.$el.html(""),this.collection.each(this.addLearningOutcome,this);var a=0;this.assessments.each(function(b){a+=parseFloat(b.get("weight"))});var b=(100*a).toFixed();return 1>a?$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments only total "+b+"%</span>"):a>1&&$("#summary thead th:nth-child(3)").css("background-color","lightyellow").append("<br><span style='font-size: 8pt; color: #A91B0C;'>Note: Assessments total "+b+"%</span>"),this},checkOutcomeMappings:function(a,b,c){c.find("help-block").remove(),c.parent().removeClass("danger");var d="<span class='form-group has-error'><span class='help-block'>This learning outcome has no %n%</span></span>";if(0===a.length){var e=d.replace("%n%","assessments.");c.append(e),c.parent().addClass("danger")}if(0===b.length){var e=d.replace("%n%","learning activities.");c.append(e),c.parent().addClass("danger"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("danger")}a.length>0&&b.length>0&&(c.parent().addClass("success"),c.parent().next("tr").find("td:not([colspan])").parent().addClass("success"))},addLearningOutcome:function(a){var b,c=this.assessments.byLearningOutcomeId(a.id),d=this.learningActivities.byLearningOutcomeId(a.id),e=c.length>d.length?c.length:d.length,f="<tr><td></td><td></td></tr>";this.$el.append(f);var g=this.$el.find("tr").length>0?this.$el.find("tr").length-1:0,h=g,i=g,j=function(b,c){b==g?(c.$el.find("tr:eq("+b+")").append("<td></td>"),c.$el.find("tr:eq("+b+") td:eq(0)").attr("rowspan",e),c.$el.find("tr:eq("+b+") td:eq(0)").text(a.get("name"))):c.$el.append(f)};e>0?(b=c.length>d.length?c:d,b.each(function(){j(i,this),i+=1},this)):j(i,this),i=g,d.each(function(a){var b=0;i==g&&(b=1),this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p><strong>Week: </strong>"+a.get("week")+"<strong><br>Context: </strong>"+a.get("type")+"</article>"),i+=1},this),i=g,c.each(function(a){var b=1;i==g&&(b=2);var c=a.get("week"),d="<strong>Due:</strong> Week ";if(-1!==c.indexOf("_")){var e=c.split("_");c=e[0]+" - "+e[1],d="Weeks: "}"ongoing"===c&&(d="",c="Ongoing formative");var f=(100*parseFloat(a.get("weight"))).toFixed();this.$el.find("tr:eq("+i+") td:eq("+b+")").html("<article><p>"+a.get("name")+"</p>"+d+c+" <br><strong>Type: </strong> "+a.get("type")+"<br><strong>Weight: </strong> "+f+"%</article>"),i+=1},this),this.checkOutcomeMappings(c,d,this.$el.find("tr:eq("+h+") td:eq(0)"))}});var app=app||{};app.summaryView=Backbone.View.extend({template:_.template($("#summaryForm").html()),render:function(){var a=this.template();return this.$el.html(a),this}}),console.log("'Allo 'Allo!");